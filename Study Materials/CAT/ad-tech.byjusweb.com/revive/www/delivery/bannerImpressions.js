async function fetchLogImpressions(e){return(await fetch(e)).ok?Promise.resolve():Promise.reject(new Error("Impression logging script did not get executed"))}async function loadScriptImage(e){const t=e.getAttribute("logimpressionsrc");if(!t)return Promise.reject(new Error("Impression script source not found"));const r=e.getAttribute("adtechmedia");let o=null;if(r&&(o=window.matchMedia(r)),o&&!o.matches){const e=async o=>{if(!window.matchMedia(r).matches)return Promise.resolve();fetchLogImpressions(t),window.removeEventListener("resize",e)};return window.addEventListener("resize",e),Promise.resolve()}return fetchLogImpressions(t),Promise.resolve()}async function countImpressions(e,t){const r=Promise.resolve();for(const o of e){if(!o.isIntersecting)continue;let e=o.target.querySelector("div.adtech-banner-impressions img");e||"adtech-register-modal-widget"!=o.target.getAttribute("id")&&"adtech-register-now-bottom-widget"!=o.target.getAttribute("id")||(e=o.target.parentNode.querySelector("div.adtech-banner-impressions img")),r.then((()=>loadScriptImage(e))),t.unobserve(o.target)}r.catch((e=>{}))}function intersectionObs(e){const t=new IntersectionObserver(countImpressions,{root:null,rootMargin:"0px",threshold:.5});document.querySelectorAll("div.adtech-banner-intersection-container").forEach((e=>{const r=e.querySelector("div#adtech-register-modal-widget"),o=e.querySelector("div#adtech-register-now-bottom-widget");r?t.observe(r):o?t.observe(o):t.observe(e)}))}export{intersectionObs};